## npm包版本号说明

npm install 安装默认都是安装最新的，最新的是指时间上最新的，通过^等方式指定范围那也同样是在范围里面安装最新的。



### 版本号管理：SemVer

> SemVer的中文名称是语义化版本控制规范。npm默认使用SemVer来进行模块的版本控制。一个发布到npm的包要严格遵守SemVer的版本规范，不然会发布失败。

#### 版本格式

主版本号.次版本号.修订号，[major,minor,patch]，可以用x.y.z的写法来简单表示。

- 主版本号：只有在新增了无法向下兼容的API的时候，才可以递增。
- 次版本号：只有在新增了可以向下兼容的新功能的时候，才可以递增，可以理解为feature版本。
- 修订号：只有在做了向下兼容的修正时才可以递增，可以理解为bug fix版本

#### 先行版本

当要进行大版本迭代的时候，或者增加一些核心的功能，但又不能保证新版本百分之百正常，这个时候就可以发布先行版本。SemVer规范中使用alpha、beta和rc来修饰先行版本。

- alpha：内部版本
- beta：公测版本
- rc：Release candiate，正式版本的候选版本

先行版本的版本号可以使用：1.0.0-alpha、1.0.0-beta.1、1.0.0- rc.1、1.0.0-0.3.7等。

#### 版本号的优先级

进行版本号比较时，x、y、z依次比较

先行版本号的规则是rc > beta > alpha

```
1.0.0 < 2.0.0 < 2.1.0 < 2.1.1     1.0.0-alpha < 1.0.0-alpha.1 < 1.0.0-alpha.beta < 1.0.0-beta < 1.0.0-beta.2 < 1.0.0-beta.11 < 1.0.0- rc.1 < 1.0.0 
```

#### 常用的版本升级符号

##### 范围range

**说明：是一组 comparators指定满足该范围的版本。**

comparators由operator和version组成。

> - `<` 少于
> - `<=` 小于或等于
> - `>` 大于
> - `>=` 大于或等于
> - `=`等于。如果未指定运算符，则假定相等，因此该运算符是可选的，但可以包括在内。

```js
// example
>=1.2.7 匹配 1.2.7，1.2.8，2.5.3等，不会匹配1.2.6,1.1.0
```

比较器可以通过空格连接，取交集。

比较器可以通过||连接，取并集。

```js
// example
>=1.2.7 <1.3.0 匹配1.2.7，1.2.8和1.2.99，不会匹配1.2.6,1.3.0,1.1.0
// example2
1.2.7 || >=1.2.9 <2.0.0 匹配1.2.7，1.2.9和1.4.6，不会匹配1.2.8,2.0.0
```





##### ^符: ^1.2.3 ^0.2.5 ^0.0.4

^符是npm安装依赖的默认方式。

**说明：允许所做的更改不会修改[major，minor，patch]元祖中最左边的非零数字。**

```
^1.2.3  <=>  >=1.2.3 <2.0.0
^0.2.3  <=>  >=0.2.3 <0.3.0
^0.0.3  <=>  >=0.0.3 <0.0.4   
^1.2.3-beta.2  <=>  >=1.2.3-beta.2 <2.0.0 
^0.0.3-beta    <=>  >=0.0.3-beta <0.0.4
```

如果patch缺失，解析时，将会退化为0，但允许在该值内保持灵活性，即使major和minor都为0.

```js
^1.2.x  <=>  >=1.2.0 <2.0.0 
^0.0.x  <=>  >=0.0.0 <0.1.0 
^0.0    <=>  >=0.0.0 <0.1.0   
```

如果minor和patch都缺失，也是变成0，但是即使major为0，也允许这些值保持灵活性。

```js
^1.x := >=1.0.0 <2.0.0
^0.x := >=0.0.0 <1.0.0
```

> 就是说，不改左边第一个非零数，如果有x，那么x代表任意数，即这一位都在范围内。

##### ~符： ~1.2.3 ~1.2 ~1

~符是是一种很保守的依赖管理策略。

**说明：如果指定了minor版本号，那么允许patch级版本更改。如果没有指定minor版本号，允许minor级版本更改。**

```js
~1.2.3 := >=1.2.3 <1.(2+1).0 := >=1.2.3 <1.3.0
~1.2 := >=1.2.0 <1.(2+1).0 := >=1.2.0 <1.3.0 (Same as 1.2.x)
~1 := >=1.0.0 <(1+1).0.0 := >=1.0.0 <2.0.0 (Same as 1.x)
~0.2.3 := >=0.2.3 <0.(2+1).0 := >=0.2.3 <0.3.0
~0.2 := >=0.2.0 <0.(2+1).0 := >=0.2.0 <0.3.0 (Same as 0.2.x)
~0 := >=0.0.0 <(0+1).0.0 := >=0.0.0 <1.0.0 (Same as 0.x)
~1.2.3-beta.2 := >=1.2.3-beta.2 <1.3.0
```



##### 固定版本：2.3.1

固定版本的依赖是确定的，除非手动升级，不然每次都安装相同的版本。

### 版本冲突

当一个依赖包出现版本冲突时，会根据这个包不同的升级策略来确定版本号。如果最后的版本号相同，只会在项目的node_modules里面安装这个版本的依赖；如果版本号不同，则两个版本号的依赖都会安装。

因为每个npm包的版本更迭都不同，所以并没有一个固定的规则去适用所有的情况。当一个包被多次依赖的时候，需要去npm的官网去查看这个包所有的版本，然后根据依赖的升级规则，去判断这个包是否会版本冲突。



### 参考资料

npm文档： https://docs.npmjs.com/misc/semver